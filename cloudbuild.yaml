steps:
# 1. Construir (Agregamos la etiqueta :latest)
- name: 'Build images'
  args: 
    - 'build'
    - '-t'
    - 'us-central1-docker.pkg.dev/nextum-labs/nextumlabs-repo/nextumlabs-app:$COMMIT_SHA'
    - '-t'
    - 'us-central1-docker.pkg.dev/nextum-labs/nextumlabs-repo/nextumlabs-app:latest'
    - '.'

# 2. Subir ambas etiquetas
- name: 'Upload images'
  args: ['push', 'us-central1-docker.pkg.dev/nextum-labs/nextumlabs-repo/nextumlabs-app:$COMMIT_SHA']

- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'us-central1-docker.pkg.dev/nextum-labs/nextumlabs-repo/nextumlabs-app:latest']

# 3. Desplegar
- name: 'Deploy'
  args:
  - run
  - --filename=k8s/nextum-app.yaml
  - --location=us-central1
  - --cluster=nextumlabs-cluster
